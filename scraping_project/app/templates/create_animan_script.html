<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>台本作成ページ</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
    <script>
        function generateFields() {
            const container = document.getElementById('character-selection-container');
            container.innerHTML = '';

            const numParticipants = document.getElementById('num_participants').value;

            for (let i = 0; i < numParticipants; i++) {
                const label = document.createElement('label');
                label.textContent = `キャラクター ${i + 1}:`;

                const select = document.createElement('select');
                select.name = 'narration_voices[]';

                // 既に生成されたオプションをコピー
                const options = document.getElementById('default-options').cloneNode(true);
                select.innerHTML = options.innerHTML;

                container.appendChild(label);
                container.appendChild(select);
                container.appendChild(document.createElement('br'));
            }
        }
    </script>
</head>
<body>
    <h1>台本作成</h1>
    <form action="{{ url_for('create_animan_script') }}" method="POST" onsubmit="return showPopup()">
        <!-- 抽出元URLの入力 -->
        <label for="URL">抽出元URL:</label>
        <input type="text" id="url" name="url" placeholder="URLを入力" required>

        <!-- タイトルコール音声選択 -->
        <label for="title_voice">タイトルコール音声:</label>
        <select id="title_voice" name="title_voice">
            {% for voice in voices %}
            <option value="{{ voice.name }}" {% if voice.name == '四国めたん' %}selected{% endif %}>{{ voice.name }}</option>
            {% endfor %}
        </select>

        <!-- 参加音声人数の入力 -->
        <label for="num_participants">参加音声人数:</label>
        <input type="number" id="num_participants" name="num_participants" min="1" max="10" required>
        <button type="button" onclick="generateFields()">決定</button>

        <!-- 読み上げ音声選択 -->
        <label for="narration_voice">読み上げ音声のキャラクター:</label>
        <!-- キャラクター選択を表示するためのコンテナ -->
        <div id="character-selection-container">
            <!-- 初期状態ではキャラクター選択フィールドはなし -->
        </div>

        <!-- ここで全てのオプションを事前に定義しておく -->
        <select id="default-options" style="display:none;">
            {% for voice in voices %}
            <option value="{{ voice.name }}">{{ voice.name }}</option>
            {% endfor %}
        </select>

        <p><input type="submit" value="作成"></p>
    </form>
    <a href="{{ url_for('index') }}">HOME</a>
</body>
</html>
